<!doctype html>
<html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Imperfect Turing Patterns - Probe FBO</title>
<link rel="manifest" href="manifest.json"/><meta name="theme-color" content="#111111"/>
<style>
:root{color-scheme:dark}body{margin:0;background:#0b0b0f;color:#e8e8ee;font-family:system-ui,-apple-system,'Segoe UI',Roboto,sans-serif}
header{padding:12px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #222}
#wrap{display:grid;grid-template-columns:1fr 320px;height:calc(100vh - 54px)}
#canvasWrap{position:relative;background:#050508}#glcanvas{width:100%;height:100%;display:block}
#ui{padding:12px;overflow:auto;border-left:1px solid #222}.group{margin-bottom:16px;border:1px solid #222;border-radius:12px;padding:12px;background:#111218;box-shadow:0 4px 12px rgba(0,0,0,.25) inset}
.row{display:grid;grid-template-columns:1fr 60px;gap:10px;align-items:center;margin:8px 0}
input[type=range]{width:100%}button{background:#1b1d29;border:1px solid #2a2d3a;color:#e8e8ee;border-radius:10px;padding:8px 10px;cursor:pointer}
.small{font-size:12px;opacity:.8}.grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}

/* === Mobile minimal: hide controls entirely === */
@media (max-width: 860px){
  #wrap{
    grid-template-columns: 1fr !important;
    grid-template-rows: 1fr !important;
    height: calc(100vh - 54px) !important;
  }
  #ui{ display: none !important; }
}
/* Toggle class to show UI if needed */
.show-ui #ui{ display:block !important; }

</style></head>
<body>
<header><img src="icons/icon-192.png" width="24" height="24" alt="icon"><h1>Imperfect Turing Patterns（FBO自動プローブ版）</h1><div style="margin-left:auto"><button id="btnInstall">PWA インストール</button></div></header>
<div id="wrap"><div id="canvasWrap"><canvas id="glcanvas"></canvas></div>
<div id="ui">
  <div class="group"><h3>基本</h3>
    <div class="row"><label>feed F <span id="labF" class="small"></span></label><input id="feed" type="range" min="0" max="0.08" step="0.0005" value="0.035"></div>
    <div class="row"><label>kill k <span id="labK" class="small"></span></label><input id="kill" type="range" min="0" max="0.09" step="0.0005" value="0.06"></div>
    <div class="row"><label>D_U <span id="labDU" class="small"></span></label><input id="du" type="range" min="0" max="2" step="0.01" value="0.16"></div>
    <div class="row"><label>D_V <span id="labDV" class="small"></span></label><input id="dv" type="range" min="0" max="2" step="0.01" value="0.08"></div>
    <div class="row"><label>Δt <span id="labDT" class="small"></span></label><input id="dt" type="range" min="0.1" max="1.5" step="0.01" value="1.0"></div>
    <div class="grid2"><button id="btnReset">初期化</button><button id="btnSeed">中央シード</button></div>
  </div>
  <div class="group"><h3>新要素</h3>
    <div class="row"><label>α <span id="labAlpha" class="small"></span></label><input id="alphaDP" type="range" min="0" max="2" step="0.01" value="0.75"></div>
    <div class="row"><label>λ <span id="labLambda" class="small"></span></label><input id="lambdaR" type="range" min="0" max="2" step="0.01" value="1.0"></div>
    <div class="row"><label>β <span id="labBeta" class="small"></span></label><input id="betaHS" type="range" min="0" max="1" step="0.01" value="0.65"></div>
    <div class="row"><label>t0 <span id="labT0" class="small"></span></label><input id="t0HS" type="range" min="0" max="1" step="0.01" value="0.35"></div>
    <div class="row"><label>t1 <span id="labT1" class="small"></span></label><input id="t1HS" type="range" min="0" max="1.5" step="0.01" value="0.85"></div>
    <div class="row"><label>noise <span id="labNoise" class="small"></span></label><input id="noiseAmt" type="range" min="0" max="0.02" step="0.0005" value="0.002"></div>
    <div class="grid2"><button id="btnRegenR">半径マップ再乱数化</button><button id="btnShowR">半径マップ表示/戻す</button></div>
  </div>
  <div class="group"><h3>プリセット</h3>
    <div class="grid2"><button id="presetLeopard">Leopard</button><button id="presetPuffer">Pufferfish Hex</button></div>
    <div class="grid2" style="margin-top:8px;"><button id="presetZebra">Zebra</button><button id="presetMosaic">Mosaic</button></div>
  </div>
  <div class="group"><h3>操作</h3>
    <div class="grid2"><button id="btnPause">一時停止</button><button id="btnResume">再開</button></div>
    <div class="grid2" style="margin-top:8px;"><button id="btnScreenshot">PNG保存</button><button id="btnClearSW">全キャッシュ削除</button></div>
  </div>
</div></div>
<script type="module" src="main.js"></script>
<script>let dP; window.addEventListener('beforeinstallprompt',e=>{e.preventDefault(); dP=e;}); document.getElementById('btnInstall')?.addEventListener('click',async()=>{if(dP){dP.prompt(); await dP.userChoice; dP=null;} else alert('インストール不可の状態です');});</script>

<script>
(function(){
  var h=document.querySelector('header')||document.body, t=0;
  function tap(){
    var now=Date.now();
    if(now - t < 450){ // double→triple window
      if(h.__d){ 
        if(now - h.__d < 450){
          document.body.classList.toggle('show-ui');
          window.dispatchEvent(new Event('resize'));
        }
      }
      h.__d = now;
    }else{
      h.__d = 0;
    }
    t = now;
  }
  h.addEventListener('click', tap, {passive:true});
})();
</script>

</body></html>